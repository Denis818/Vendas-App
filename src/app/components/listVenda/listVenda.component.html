<div
  class="d-flex flex-wrap justify-content-between align-items-center my-3 bg-secondary rounded sombra p-3 responsive-input">
  <div class="text-white d-flex align-items-center mb-2 mb-md-0">
   <!--  <h4 class="mb-0" style="  color: rgba(243, 243, 243, 0.843); text-shadow: 4px 4px 7px rgba(0, 0, 0, 30.5);"><i
        class="fa fa-money mr-2" style="color: #0ed600"></i> Total Geral das Vendas:
      <b class="total" [ngStyle]="{'color': totalDasVendas < 40 ? 'red' : '#0fe400'}">
        R$ {{totalDasVendas.toFixed(2)}}</b>
    </h4> -->
  </div>
  <div class="d-flex justify-content-end">
    <div class="">
      <input class="" placeholder="Pesquisar por data" [(ngModel)]="dateRange" bsDaterangepicker id="filtroData"
        style="width: 300px; margin-left: auto;" (bsValueChange)="validateDateRange()">
    </div>
    <button class="btn btn-success sombra" (click)="getVendasPorPeriodo()" style="margin-left: 10px;">
      Aplicar
    </button>
  </div>
  <button class="btn btn-success sombra" (click)="abrirModal(modalForm)" style="width: 90px; height: 43.9px;">
    Novo <i class="fa fa-plus-circle my-1"></i>
  </button>
</div>

<div class="card rounded sombra p-3">
  <div class="d-flex">
    <div class="flex-fill pr-3">
      <div class="input-group mb-2">
        <div class="input-group-prepend">
          <div class="input-group-text  p-2 rounded shadow-sm">Filtro:</div>
        </div>
        <input type="text" class="form-control p-2 rounded sombra-input" placeholder="Filtrar por Tema e Local"
          [(ngModel)]="filtroLista">
      </div>
    </div>
  </div>

  <div class="responsive-table">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>#</th>
          <th>Produto</th>
          <th>Pre√ßo</th>
          <th class="text-center">Quantidade</th>
          <th>Data da Venda</th>
          <th>Total</th>
          <th>Op√ß√µes</th>
        </tr>
      </thead>
      <tbody *ngIf="listVendas && listVendas.length > 0">
        <tr
          *ngFor="let venda of vendasFiltradas | paginate: { itemsPerPage: itemsPorPagina, currentPage: paginaAtual, totalItems: totalItens }">
          <td>{{venda.id}}</td>
          <td>{{venda.nome}}</td>
          <td>R$ {{venda.preco.toFixed(2)}}</td>
          <td class="text-center">{{venda.quantidadeVendido}}</td>
          <td>{{venda.dataVenda}}</td>
          <td>R$ {{venda.totalDaVenda.toFixed(2)}}</td>
          <td>
            <div class="btn-group-custom">
              <button type="button" class="btn btn-primary btn-lg" tooltip="Editar"
                (click)="abrirModal(modalForm, venda.id)" style="margin-right: 5px;">
                <i class="fa fa-edit"></i>
              </button>
              <button type="button" class="btn btn-danger btn-lg" tooltip="Deletar"
                (click)="abrirModal(modalConfirmDelete, venda.id)">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
      <tfoot *ngIf="vendasFiltradas.length === 0 && filtroLista">
        <tr>
          <td colspan="8" class="text-center">
            <h4>Nenhuma venda encontrada!</h4>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
  <div style="display: flex; justify-content: center;">
    <pagination-controls (pageChange)="paginaAtual = $event; getAllVendas()"></pagination-controls>
  </div>
  <div class="d-flex justify-content-end">
    <div class="vendas-final col-md-auto" style="margin-right: auto;">
      <b>Total Itens: {{totalItens}}</b>
    </div>
    <div class="vendas-final col-md-auto">
      <b>Subtotal da p√°gina:
        <b [ngStyle]="{'color': vendidoPorPagina < 25 ? 'red' : '#0fe400'}">
          R$ {{vendidoPorPagina.toFixed(2)}}
        </b>
      </b>
      <b *ngIf="vendidoPorPagina < 25">&nbsp;&nbsp;üòî</b>
      <b *ngIf="vendidoPorPagina > 25">&nbsp;&nbsp;ü§ë</b>
    </div>

  </div>
</div>

<ng-template #modalConfirmDelete>
  <div class="modal-body text-center">
    <p>Tem certeza que quer deletar este Evento?</p>
    <button type="button" class="btn btn-danger" style="margin-right: 5px;" (click)="confirmDelete()">Sim</button>
    <button type="button" class="btn btn-primary" (click)="this.modal.hide()">N√£o</button>
  </div>
</ng-template>

<ng-template #modalForm>
  <div class="card rounded shadow-sm" style="margin-left: 0;">
    <h2
      style="display: flex; justify-content: center; margin-top: 20px; color: #007BFF; font-weight: 600; font-size: 24px; padding-bottom: 20px; border-bottom: 2px solid #e9ecef; text-shadow: 4px 4px 7px rgba(0, 0, 0, 0.5);">
      Preencha os Campos</h2>
    <div class="modal-body container" [formGroup]="form" style="padding: 30px;">
      <div class="form-row">
        <div class="form-group col-md-auto mr-2">
          <label style="font-weight: 500; font-size: 18px;">Nome do Produto</label>
          <input type="text" class="form-control"
            [ngClass]="{'is-invalid': vendaValidator.nome.errors && vendaValidator.nome.touched}"
            formControlName="produto" placeholder="Insira o nome produto"
            style="border-radius: 5px; border: 2px solid #ced4da; padding: 10px 15px; font-size: 16px;">
          <div *ngIf=" vendaValidator.nome.errors?.required" class="invalid-feedback">
            Nome do Produto √© obrigat√≥rio.
          </div>
          <div *ngIf=" vendaValidator.produto.errors?.minlength" class="invalid-feedback">
            Produto deve ter no m√≠nimo 4 caracteres
          </div>
          <div *ngIf=" vendaValidator.produto.errors?.maxlength" class="invalid-feedback">
            Produto deve ter no max√≠mo 50 caracteres
          </div>
        </div>
      </div>
      <div class="form-row" style="margin-bottom: 25px;">
        <div class="form-group col-md-auto">
          <label style="font-weight: 500; font-size: 18px;">Pre√ßo</label>
          <input type="text" class="form-control"
            [ngClass]="{'is-invalid': vendaValidator.preco.errors && vendaValidator.preco.touched}"
            formControlName="preco" placeholder="0.00"
            style="border-radius: 5px; border: 2px solid #ced4da; padding: 10px 15px; font-size: 16px;">
          <div *ngIf=" vendaValidator.preco.errors?.required" class="invalid-feedback">
            Pre√ßo √© obrigat√≥rio.
          </div>
          <div *ngIf=" vendaValidator.preco.errors?.pattern" class="invalid-feedback">
            Pre√ßo n√£o √© valido.
          </div>
        </div>
      </div>
      <div class="form-row" style="margin-bottom: 25px;">
        <div class="form-group col-md-auto">
          <label style="font-weight: 500; font-size: 18px;">Quantidade Vendido</label>
          <input type="text" class="form-control"
            [ngClass]="{'is-invalid': vendaValidator.quantidadeVendido.errors && vendaValidator.quantidadeVendido.touched}"
            formControlName="quantidadeVendido" placeholder="0"
            style="border-radius: 5px; border: 2px solid #ced4da; padding: 10px 15px; font-size: 16px;">
          <div *ngIf=" vendaValidator.quantidadeVendido.errors?.required" class="invalid-feedback">
            Quantidade √© obrigat√≥ria.
          </div>
          <div *ngIf=" vendaValidator.quantidadeVendido.errors?.pattern" class="invalid-feedback">
            Quantidade n√£o √© valida.
          </div>
        </div>
      </div>

      <div class="card-footer" style="background-color: #f8f9fa; border-top: 2px solid #e9ecef;">
        <div style="margin-top: 5px;"></div>
        <div class="d-flex justify-content-between">
          <button class="btn btn-outline-secondary border col-md-auto" (click)="resetForm()"
            style="border-radius: 5px; font-size: 16px; transition: background-color 0.3s; margin-right: 4px;">
            Fechar
          </button>
          <button class="btn btn-success col-md-auto sombra" [disabled]="!form.valid" (click)="adicionarVenda()"
            style="border-radius: 5px; font-size: 16px; transition: background-color 0.3s;">
            Salvar Venda
          </button>
        </div>
      </div>
    </div>
  </div>

</ng-template>
